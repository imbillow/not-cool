# README file for Programming Assignment 2 (C++ edition)


Your directory should contain the following files:

 Makefile
 README
 cool.flex
 test.cl
 lextest.cc      -> [cool root]/src/PA2/lextest.cc
 mycoolc         -> [cool root]/PA2/mycoolc
 stringtab.cc    -> [cool root]/PA2/stringtab.cc
 utilities.cc    -> [cool root]/PA2/utilities.cc
 handle_flags.cc -> [cool root]/PA2/handle_flags.cc
 *.d             dependency files
 *.*             other generated files

The include (.h) files for this assignment can be found in
[cool root]/PA2

The Makefile contains targets for compiling and running your
program. DO NOT MODIFY.

The README contains this info. Part of the assignment is to fill
the README with the write-up for your project. You should
explain design decisions, explain why your code is correct, and
why your test cases are adequate. It is part of the assignment
to clearly and concisely explain things in text as well as to
comment your code. Just edit this file.

cool.flex is a skeleton file for the specification of the
lexical analyzer. You should complete it with your regular
expressions, patterns and actions.

test.cl is a COOL program that you can test the lexical
analyzer on. It contains some errors, so it won't compile with
coolc. However, test.cl does not exercise all lexical
constructs of COOL and part of your assignment is to rewrite
test.cl with a complete set of tests for your lexical analyzer.

cool-parse.h contains definitions that are used by almost all parts
of the compiler. DO NOT MODIFY.

stringtab.{cc|h} and stringtab_functions.h contains functions
        to manipulate the string tables.  DO NOT MODIFY.

utilities.{cc|h} contains functions used by the main() part of
the lextest program. You may want to use the strdup() function
defined in here. Remember that you should not print anything
from inside cool.flex! DO NOT MODIFY.

lextest.cc contains the main function which will call your
lexer and print out the tokens that it returns.  DO NOT MODIFY.

mycoolc is a shell script that glues together the phases of the
compiler using Unix pipes instead of statically linking code.
While inefficient, this architecture makes it easy to mix and match
the components you write with those of the course compiler.
DO NOT MODIFY.

cool-lexer.cc is the scanner generated by flex from cool.flex.
DO NOT MODIFY IT, as your changes will be overritten the next
time you run flex.

 The *.d files are automatically generated Makefiles that capture
 dependencies between source and header files in this directory.
 These files are updated automatically by Makefile; see the gmake
 documentation for a detailed explanation.

## Instructions

To compile your lextest program type:

% make lexer

Run your lexer by putting your test input in a file 'foo.cl' and
run the lextest program:

% ./lexer foo.cl

To run your lexer on the file test.cl type:

% make dotest

If you think your lexical analyzer is correct and behaves like
the one we wrote, you can actually try 'mycoolc' and see whether
it runs and produces correct code for any examples.
If your lexical analyzer behaves in an
unexpected manner, you may get errors anywhere, i.e. during
parsing, during semantic analysis, during code generation or
only when you run the produced code on spim. So beware.

If you change architectures you must issue

% make clean

when you switch from one type of machine to the other.
If at some point you get weird errors from the linker,
you probably forgot this step.

GOOD LUCK!

---8<------8<------8<------8<---cut here---8<------8<------8<------8<---

## Write-up for PA2

> Although these files are incomplete as given, the lexer does compile and run (make lexer).

它无法编译(使用系统默认版本的 flex 2.6.4 + gcc 10.1.0)。
不过我用 nix-shell 的 flex 2.5.35 + gcc 6.5.0 环境成功编译了它。

尝试过，使用 Java 版本，但是 `make lexer` 也会失败。（还写了个 Gradle 的配置）。

想起来 nix 应该是可行的，（实际上它确实挺擅长这种事情），不过也没有很顺利。
首先它的介绍不太友好，然后下载站被墙，没有镜像，发现设置代理的环境变量没有用（但是 kiva 用 Ubuntu + nix 又有用？），`proxychains` 没有用。我尝试给予 `iptables` 的透明代理，没有用？ `badvpn-tun2socks`， 没有用？

直到看到[这里](https://github.com/yangchuansheng/love-gfw/blob/master/docs/iptables-linux.md#%E9%85%8D%E7%BD%AE%E6%99%BA%E8%83%BD-dns-%E6%9C%8D%E5%8A%A1)。
我把 Firefox 的 DOH(DNS over HTTPS) 打开，发现一切OK。才意识到这个问题。
